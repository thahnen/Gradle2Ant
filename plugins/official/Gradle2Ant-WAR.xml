<?xml version="1.0" encoding="UTF-8" ?>
<project name="Gradle2Ant-WAR">
    <description>
        Call Gradle from Ant - Gradle WAR plugin!
    </description>

    <!-- General properties! -->
    <dirname property="current.dir" file="${ant.file}" />

    <!-- import general Gradle2Ant.xml library -->
    <import file="../../Gradle2Ant.xml" />


    <!-- Gradle task "war" to create WAR web archive -->
    <macrodef name="gradle.war" description="Gradle task 'war'">
        <attribute name="project"   default="" />
        <attribute name="args"      default="" />
        <attribute name="wrapper"   default="gradle" />
        <attribute name="dir"       default="${current.dir}" />

        <sequential>
            <gradle task="war"
                    project="@{project}"
                    args="@{args}"
                    wrapper="@{wrapper}"
                    dir="@{dir}" />
        </sequential>
    </macrodef>


    <!-- Macro to get the generated WAR archive file name -->
    <scriptdef name="vGradleWarName" language="javascript" description="">
        <attribute name="folder" />
        <attribute name="pname" />
        <![CDATA[
            var files = (new java.io.File(attributes.get("folder"))).listFiles();
            for (i = 0; i < files.length; i++) {
                var fn = files[i].getName();
                if (fn.indexOf(attributes.get("pname")) !== -1 && fn.indexOf(".war") !== -1) {
                    project.setProperty("gradle.war.name", fn);
                    break;
                }
            }
        ]]>
    </scriptdef>
</project>
